@model DYMobileFirst.Models.Book

@{
    ViewBag.Title = "新建";
}
<section id="content">
    <section class="main padder">
        <div class="clearfix">
            <h4>
                <i class="fa fa-edit">
                </i>
                新建
            </h4>
        </div>

        @using (Html.BeginForm("Create", "Book", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
            @Html.AntiForgeryToken()

            <div class="form-horizontal">
                <h4>Book</h4>
                <hr />
                @Html.ValidationSummary(true)

                <div class="form-group">
                    @Html.LabelFor(model => model.Title,"自动查询", new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.Hidden("ajaxSelect", "", new { style = "width:100%" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Title, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Title)
                        @Html.ValidationMessageFor(model => model.Title)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.ReleaseDate, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.ReleaseDate)
                        @Html.ValidationMessageFor(model => model.ReleaseDate)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Genre, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Genre)
                        @Html.ValidationMessageFor(model => model.Genre)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.Price, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.Price)
                        @Html.ValidationMessageFor(model => model.Price)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.staute, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.staute)
                        @Html.ValidationMessageFor(model => model.staute)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.pub, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.EditorFor(model => model.pub)
                        @Html.ValidationMessageFor(model => model.pub)
                    </div> 
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.AuthorId, "作者", new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.DropDownList("AuthorId", ViewBag.AuthorId as SelectList, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.AuthorId)
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-2">商品图</label>
                    <div class="col-md-10">
                        <input type="file" name="files" id="file1" />
                        <input type="file" name="files" id="file2" />
                        <input type="file" name="files" id="file3" />
                        <input type="file" name="files" id="file4" />
                        <input type="file" name="files" id="file5" />
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="submit" value="保存" class="btn btn-default" />
                    </div>
                </div>
            </div>
        }

        <div>
            @*@Html.ActionLink("返回", "Index", new { pi = 1, ps = 15 }, new { @class = "btn btn-info btn-xs" })*@
            <a class="btn btn-info btn-xs" onclick="Javascript:window.history.go(-1);">返回</a>
        </div>
    </section>
</section>
@section Scripts {
<script type="text/javascript">
    function format(state) {
        //if (!state.id) return state.text; // optgroup
        //return "<img class='flag' src='images/flags/" + state.id.toLowerCase() + ".png'/>" + state.text;
        return state.text + "/" + state.genre + "/￥" + state.price;
    }
    $(function () {
        //this javascript call sets up the select2 that loads search results via ajax calls
        $('#ajaxSelect').select2({
            placeholder: '输入书名自动完成',
            minimumInputLength: 1,
            formatResult: format,
            ajax: {
                url: '@Url.Action("SearchTitles", "Book")',
                dataType: 'json',
                data: function (term, page) {
                    return {
                        searchTerm: term
                    };
                },
                results: function (data, page) {
                    return { results: data };
                }
            }
        });
    });
    $("#ajaxSelect").on("select2-selecting", function (e) {
        alert("selecting val=" + e.val + " choice=" + JSON.stringify(e.choice));
        $("#Title").val(e.choice.text);
        $("#Price").val(e.choice.price);
        //em服务端要tostring
        $("#staute").val(e.choice.em);
        $("#pub").val(e.choice.pub);
        $("#AuthorId").val(e.choice.author);
    })
</script>
}
